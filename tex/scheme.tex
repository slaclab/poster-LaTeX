\newcommand{\state}[8]{
	% #1, #2: x and y offset position
	% #3, #4, #5: top voltage values, from left to right
	% #6, #7, #8: bot voltage values, from left to right
	\draw ($ ({#1},{#2}) + (0.65,-2.55)$) node[] { $C$};
	\draw ($ ({#1},{#2}) + (0.15,-2.55)$) node[] { $C$};
	\draw ($ ({#1},{#2}) + (-0.3,-2.55)$) node[] { $2C$};
	\draw ($ ({#1},{#2}) + (-0.5,-2.15)$) to[C] ($ ({#1},{#2}) + (-0.5,-2.65)$);
	\draw ($ ({#1},{#2}) + (0.0,-2.15) $) to[C] ($ ({#1},{#2}) + (0.0,-2.65)$);
	\draw ($ ({#1},{#2}) + (0.5,-2.15) $) to[C] ($ ({#1},{#2}) + (0.5,-2.65)$);
	\draw ($ ({#1},{#2}) + (-0.5,-2.65)$) to[short] ($ ({#1},{#2}) + (0.5,-2.65)$);

	\draw ($ ({#1},{#2}) + (1.25,-2.825)$) node[plain amp, line width=0.2, yscale=-1] (opamp1) {};
	\draw ($ ({#1},{#2}) + (1.08,-3.0) $) node[] { $-$};
	\draw ($ ({#1},{#2}) + (1.08,-2.65) $)node[] { $+$};
	\draw (opamp1.-) to[short] ($ ({#1},{#2})+(0.5,-3.0) $);
	\draw (opamp1.+) to[short] ($ ({#1},{#2})+(0.5,-2.65)$);
	
	\draw ($ ({#1},{#2}) + (0.65,-3.1)$) node[] { $C$};
	\draw ($ ({#1},{#2}) + (0.15,-3.1)$) node[] { $C$};
	\draw ($ ({#1},{#2}) + (-0.3,-3.1)$) node[] { $2C$};
	\draw ($ ({#1},{#2}) + (-0.5,-3.0)$) to[C] ($ (#1,#2)+(-0.5,-3.5)$);
	\draw ($ ({#1},{#2}) + (0.0,-3.0) $) to[C] ($ (#1,#2)+(0.0,-3.5)$);
	\draw ($ ({#1},{#2}) + (0.5,-3.0) $) to[C] ($ (#1,#2)+(0.5,-3.5)$);
	\draw ($ ({#1},{#2}) + (-0.5,-3.0)$) to[short] ($ (#1,#2)+(0.5,-3.0)$);


	\ifthenelse{\equal{#3}{C}}{
		\draw[gray] ($ ({#1},{#2}) + (-0.5,-3.5) $) to[short] ($ ({#1},{#2}) + (-0.75,-3.5) $);
		\draw[gray] ($ ({#1},{#2}) + (-0.75,-3.5)$) to[short] ($ ({#1},{#2}) + (-0.75,-2.15)$);
		\draw[gray] ($ ({#1},{#2}) + (-0.5,-2.15)$) to[short] ($ ({#1},{#2}) + (-0.75,-2.15)$);
	}{
		\draw ($ ({#1},{#2}) + (-0.5,-2.0)$) node[]  { $#3$};
		\draw ($ ({#1},{#2}) + (-0.5,-3.65)$) node[] { $#6$};
	}

	\ifthenelse{\equal{#4}{C}}{
		\draw[gray] ($ ({#1},{#2}) + (-0.0,-3.5) $) to[short] ($ ({#1},{#2}) + (-0.25,-3.5) $);
		\draw[gray] ($ ({#1},{#2}) + (-0.25,-3.5)$) to[short] ($ ({#1},{#2}) + (-0.25,-2.15)$);
		\draw[gray] ($ ({#1},{#2}) + (-0.0,-2.15)$) to[short] ($ ({#1},{#2}) + (-0.25,-2.15)$);
	}{
		\draw ($ ({#1},{#2}) + (0.0,-2.0) $) node[]  { $#4$};
		\draw ($ ({#1},{#2}) + (0.0,-3.65) $) node[] { $#7$};
	}

	\ifthenelse{\equal{#5}{C}}{
		\draw[gray] ($ ({#1},{#2}) + (0.5,-3.5)  $) to[short] ($ ({#1},{#2}) + (0.25,-3.5)  $);
		\draw[gray] ($ ({#1},{#2}) + (0.25,-3.5) $) to[short] ($ ({#1},{#2}) + (0.25,-2.15) $);
		\draw[gray] ($ ({#1},{#2}) + (0.5,-2.15) $) to[short] ($ ({#1},{#2}) + (0.25,-2.15) $);
	}{
		\draw ($ ({#1},{#2}) + (0.5,-2.0) $) node[]  { $#5$};
		\draw ($ ({#1},{#2}) + (0.5,-3.65) $) node[] { $#8$};
	}

	% \ifthenelse{\equal{#3}{C}}{
	% 	\draw (1,1) node[] {A};
	% }{
	% 	\draw (1,1) node[] {B};
	% }
}

\newcommand{\labels}[4]{
	% #1, #2: x and y offset position
	% #3, #4: top and bot voltage increments, respectively

	% \draw ($ ({#1},{#2}) + (0.5,-2.75) $) node[] {\tiny $\Delta = {#3}$};
	% \draw ($ ({#1},{#2}) + (-0.25,-2.9) $) node[] {\tiny $\Delta = {#4}$};
	\ifthenelse{\equal{#3}{}}{
	}{
		\draw ($ ({#1},{#2}) + (0.25,-2.75) $) node[] { $\Delta = {#3}$};
	}
	\ifthenelse{\equal{#4}{}}{
	}{
		\draw ($ ({#1},{#2}) + (-0.25,-2.9) $) node[] { $\Delta = {#4}$};
	}

}

\newcommand{\switches}[2]{
	% #1, #2: x and y offset position
	\draw ($ ({#1},{#2}) + (-1.0,-2.65) $) to[ncs] ($ ({#1},{#2}) + (-0.5,-2.65) $);
	\draw ($ ({#1},{#2}) + (-1.0,-3.00) $) to[ncs] ($ ({#1},{#2}) + (-0.5,-3.00) $);

	\draw ($ ({#1},{#2}) + (-1.2,-2.50) $) node[] { $v_{i,top}$};
	\draw ($ ({#1},{#2}) + (-1.2,-3.10) $) node[] { $v_{i,bot}$};
}


% Schematic created with CircuiTikZ-Tool, www.github.com/LFanals/CircuiTikZ-Tool.git 
\begin{circuitikz}[american, /tikz/circuitikz/bipoles/length=0.5cm, scale=1.3, transform shape, /tikz/circuitikz/bipoles/thickness=1]
\tikzstyle{block} = [draw, rectangle, minimum height=1cm, minimum width=2cm]
% \tikzstyle{every node}=[font=\tiny]
\tikzstyle{every node}=[font=\fontsize{7}{7}\selectfont]

\switches{5.5}{2}
\state{5.5}{2}{1}{0}{0}{1}{0}{0}        \labels{5.5}{2}{}{}

\draw (5.8,-0.8) node[] { $v_{top}$};
\draw (5.3,-0.9) node[] { $v_{bot}$};
 
% top side
\state{9}{6}{0.5}{0}{0}{1}{0.5}{0.5}  \labels{9}{6}{- 1/4}{+ 1/4}

\state{12.5}{8}{0}{0.5}{0}{1}{1}{0.5} \labels{12.5}{8}{- 1/8}{+ 1/8}
\state{12.5}{4}{C}{0}{0}{C}{0.5}{0.5} \labels{12.5}{4}{+ 1/8}{- 1/8}

\state{16}{9}{0}{0.5}{0}{1}{1}{1}     \labels{16}{9}{0}{+ 1/8}
\state{16}{7}{0}{C}{0}{1}{C}{0.5}     \labels{16}{7}{+ 1/16}{- 1/16}
\state{16}{5}{0.5}{C}{0}{1}{C}{0.5}   \labels{16}{5}{- 1/16}{+ 1/16}
\state{16}{3}{C}{C}{0}{C}{C}{0.5}     \labels{16}{3}{+ 1/16}{- 1/16}

% bot side
\state{9}{-2}{1}{0.5}{0.5}{0.5}{0}{0}  \labels{9}{-2}{+ 1/4}{- 1/4}

\state{12.5}{-4}{1}{1}{0.5}{0}{0.5}{0} \labels{12.5}{-4}{+ 1/8}{- 1/8}
\state{12.5}{0}{C}{0.5}{0.5}{C}{0}{0} \labels{12.5}{0}{- 1/8}{+ 1/8}

\state{16}{-5}{1}{1}{1}{0}{0.5}{0}     \labels{16}{-5}{+ 1/8}{0}
\state{16}{-3}{1}{C}{0.5}{0}{C}{0}     \labels{16}{-3}{- 1/16}{+ 1/16}
\state{16}{-1}{1}{C}{0.5}{0.5}{C}{0}   \labels{16}{-1}{+ 1/16}{- 1/16}
\state{16}{1}{C}{C}{0.5}{C}{C}{0}     \labels{16}{1}{- 1/16}{+ 1/16}


\begin{scope}[xshift=0cm, yshift=-0.325cm]
	\draw [->] (14.5,5.5) -- node[midway,left] {$E=0$} (15.0,6.5);
	\draw [->] (14.5,5.5) -- node[midway,left] {$E=5/32$} (15.0,4.5);
	\draw [->] (14.5,1.5) -- node[midway,left] {$E=5/32$} (15.0,2.5);
	\draw [->] (14.5,1.5) -- node[midway,left] {$E=1/32$} (15.0,0.5);
	\draw [->] (11.0,3.5) -- node[midway,left] {$E=3/8$} (11.5,5.5);
	\draw [->] (11.0,3.5) -- node[midway,left] {$E=1/8$} (11.5,1.5);
	\draw [->] (7.5,-0.5) -- node[midway,left] {$E=-1/2$} (8,3.5);
\end{scope}

\begin{scope}[xshift=0cm, yshift=-8.325cm]
	\draw [->] (14.5,5.5) -- node[midway,left] {$E=1/32$} (15.0,6.5);
	\draw [->] (14.5,5.5) -- node[midway,left] {$E=5/32$} (15.0,4.5);
	\draw [->] (14.5,1.5) -- node[midway,left] {$E=5/32$} (15.0,2.5);
	\draw [->] (14.5,1.5) -- node[midway,left] {$E=0$} (15.0,0.5);
	\draw [->] (11.0,3.5) -- node[midway,left] {$E=1/8$} (11.5,5.5);
	\draw [->] (11.0,3.5) -- node[midway,left] {$E=3/8$} (11.5,1.5);
	\draw [->] (7.5,7.5) -- node[midway,left]  {$E=-1/2$} (8,3.5);
\end{scope}


\end{circuitikz}

   
